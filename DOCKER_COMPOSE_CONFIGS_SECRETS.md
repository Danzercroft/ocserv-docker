# Docker Compose Configs и Secrets

Этот проект теперь использует Docker Compose configs и secrets для безопасного управления конфигурационными файлами и секретными данными.

## Структура

### Configs
- **ocserv_config**: Конфигурационный файл OCServ (`./config/ocserv.conf`)
  - Монтируется в: `/etc/ocserv/ocserv.conf`
  - Права доступа: 0644
  - Содержит статическую конфигурацию с разумными значениями по умолчанию

### Secrets
- **ocserv_passwd**: Файл паролей пользователей (`./config/passwd`)
  - Доступен в контейнере как secret: `/run/secrets/ocserv_passwd`
  - Права доступа: 0600

- **server_cert**: SSL сертификат сервера (`./certs/server.crt`)
  - Доступен как secret: `/run/secrets/server_cert`
  - Права доступа: 0644

- **server_key**: Приватный ключ сервера (`./certs/server.key`)
  - Доступен как secret: `/run/secrets/server_key`
  - Права доступа: 0600

- **ca_cert**: CA сертификат (`./certs/ca.crt`)
  - Доступен как secret: `/run/secrets/ca_cert`
  - Права доступа: 0644

## Преимущества

1. **Безопасность**: Секретные файлы (пароли и приватные ключи) не копируются в образ Docker
2. **Простота**: Конфигурация использует разумные значения по умолчанию
3. **Гибкость**: Основные параметры настраиваются через переменные окружения
4. **Изоляция**: Каждый тип данных обрабатывается соответственно своему назначению
5. **Права доступа**: Автоматическая установка правильных прав доступа для файлов

## Переменные окружения

ENV почти не используются. Остались только параметры метрик (опционально):

| Переменная | По умолчанию | Описание |
|------------|--------------|----------|
| ENABLE_METRICS | true | Включить экспорт метрик |
| METRICS_PORT | 8000 | Порт экспортера |
| METRICS_INTERVAL | 30 | Интервал опроса (сек) |

## Использование

```bash
# Запуск сервиса
docker-compose up -d

# Перезапуск после изменения конфигурации
docker-compose restart

# Просмотр логов
docker-compose logs -f
```

## Примечания

- Файлы configs и secrets должны существовать до запуска
- Изменения в config требуют перезапуска контейнера
- Обновление файла паролей в Swarm: пересоздайте secret и обновите сервис
